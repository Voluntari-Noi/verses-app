<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Versete de memorat - Pentru Cer</title>
  <meta name="description" content="Description here">
</head>

<style>
  body {
    background: #DDDDDD;
  }

  h1 {
    text-align: center;
  }

  div#profile-container {
    width: 60%;
    background: #AAAAAA;
    margin-left: 20%;
    padding: 0 20px 0 20px;
    color: white;
    overflow: auto;
  }

  div#profile-container p {
    float: left;
    width: 33%;
    text-align: center;
  }

  div#exercise-container {
    width: 60%;
    background: white;
    margin-left: 20%;
    padding: 20px;
  }

  .debug {
    color: red;
    font-size: 10pt;
  }

  div#exercise-board {
    margin: 20px 0 20px 0;
    background: #333333;
    padding: 100px;
  }

  div#exercise-controls {
    width: 60%;
    background: #EEEEEE;
    margin-left: 20%;
    padding: 20px;
  }

  p {
    font-size: 16pt;
  }

  button {
    padding: 20px 80px 20px 80px;
    border: none;
    color: white;
    font-size: 20px;
  }

  button#some-experience {
    background: green;
    float: right;
  }

  button#fail {
    background: red;
  }
</style>

<body>
  <h1>Versete de memorat</h1>

  <div id="profile-container">
    <p id="info-nickname"><span>Anonim</span></p>
    <p id="info-level">Level <span>1</span></p>
    <p id="info-points"><span>0</span> points</p>
  </div>

  <div id="exercise-container">
    <div id="exercise-info">
      <p class="exercise-id debug">Exercise ID</p>
      <p id="info-consecutive-successes" class="debug">Consecutive succeses: <span>0</span></p>
      <p class="exercise-title">Exercise type here</p>
      <p class="exercise-description">Exercise description here</p>
      <p class="exercise-points debug">Points if you succeed: <span>0</span></p>
    </div>

    <div id="exercise-board">
      <p class="debug">TODO implement this for each exercise type</p>
    </div>
  </div>

  <div id="exercise-controls">
    <button id="fail">Fail</button>
    <button id="some-experience">Success</button>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

  <script>
    $("document").ready(function() {
      // Init game
      window.current_level = 1;
      window.experience_points = 0;
      window.number_of_levels = 5;
      window.points_per_level = 10;
      window.current_exercise_type = 'ID001';
      window.is_logged_in = true;
      window.consecutive_successes = 0;


      // Definition of exercises types
      window.exercises_types = {
        'ID001': {
          'title': 'Cuvinte lipsă',
          'description': 'Mută cuvintele la locul potrivit.',
          'points': 1,
        },
        'ID002': {
          'title': 'Toate cuvintele',
          'description': 'Aranjează cuvintele în ordinea potrivită, descoperă versetul.',
          'points': 2,
        },
        'ID003': {
          'title': 'Puzzle',
          'description': 'Rezolvă puzzle-ul, învață versetul.',
          'points': 3,
        },
      }

      // Simulate a user profile
      window.user_profile = {
        'nickname': 'Albert E.',
        'photo': './images/albert_e.png',
        'preferences': {
          'exercises_types': ['ID001', 'ID002']
        },
        'level': 2,
        'experience_points': 21
      }

      // Definition of nice messages listed on success
      window.success_messages = {
        'M001': 'Bravo!',
        'M002': 'Uaaaa!',
        'M003': 'Super. Ai rezolvat corect!',
        'M004': 'Se vede mult progres. Frumos!',
        'M005': 'Sunt mândru de tine. Felicitări!',
        'M006': 'Yeeey! Foarte foarte tare!'
      }

      // Definition of messages to be listed on fail
      window.fail_messages = {
        'F001': 'Ops!',
        'F002': 'Of... Nu.',
        'F003': 'Mai încearcă.',
        'F004': 'Ai greșit...',
        'F005': 'Hmm. Nu chiar.',
        'F006': 'Of of of'
      }

      // Definition of levels
      window.levels = {
        1: {
          'exercises_types': ['ID001'],
          'success_messages': ['M001', 'M002'],
          'fail_messages': ['F001']
        },
        2: {
          'exercises_types': ['ID001', 'ID002'],
          'success_messages': ['M002', 'M003'],
          'fail_messages': ['F002', 'F003']
        },
        3: {
          'exercises_types': ['ID001', 'ID002', 'ID003'],
          'success_messages': ['M003', 'M004'],
          'fail_messages': ['F003']
        },
        4: {
          'exercises_types': ['ID003'],
          'success_messages': ['M004', 'M005'],
          'fail_messages': ['F003', 'F004', 'F005']
        },
        5: {
          'exercises_types': ['ID001', 'ID002', 'ID003'],
          'success_messages': ['M005', 'M006'],
          'fail_messages': ['F006']
        },
      }

      function random_from_list(list) {
        // Return a random item from a list (array) of elements
        return list[Math.floor(Math.random() * list.length)];
      }

      function refresh_texts() {
        // Update experience points and current level
        $("p#info-points span").text(window.experience_points);
        $("p#info-level span").text(window.current_level);
        $("p#info-consecutive-successes span").text(window.consecutive_successes);
      }

      function game_over() {
        // You won!
        alert("You won the game. Congrats!");
        $("button#some-experience").hide();
        $("button#fail").hide();
      }

      function new_level() {
        // New level
        alert("New level. Yey!");
      }

      function new_exercise() {
        // Start a new exercise
        if(window.current_level === 0) {
          return;  // TODO fix me
        }

        console.log("New exercise:");
        var possible_exercises = levels[window.current_level].exercises_types;
        var choosen_exercise_id = random_from_list(possible_exercises);
        console.log(possible_exercises);
        console.log(choosen_exercise_id);

        var exercise = exercises_types[choosen_exercise_id];

        window.current_exercise_type = choosen_exercise_id;

        $("div#exercise-info p.exercise-id").text(choosen_exercise_id);
        $("div#exercise-info p.exercise-title").text(exercise.title);
        $("div#exercise-info p.exercise-description").text(exercise.description);
        $("div#exercise-info p.exercise-points span").text(exercise.points);

        console.log(window.current_exercise_type);
      }

      function update_progress() {
        // Update the experience points, check levels
        var old_points = window.experience_points;

        var points_for_this = exercises_types[window.current_exercise_type].points;
        window.experience_points += points_for_this;

        console.log("Ai câștigat " + points_for_this + " punct(e)!");

        var possible_messages = levels[window.current_level].success_messages;
        var choosen_msg_id = random_from_list(possible_messages);
        var message = success_messages[choosen_msg_id];
        alert(message);
        window.consecutive_successes += 1;

        new_exercise();

        if(window.experience_points >= window.number_of_levels * window.points_per_level) {
          game_over();
        } else {
          var level_start_at = window.current_level * window.points_per_level;
          if(experience_points > level_start_at) {
            // fix possible issue on loading profile:
            level_start_at = (window.current_level + 1) * window.points_per_level;
          }

          console.log("Old:" + old_points + " Level start at: " + level_start_at + " Experience points: " + window.experience_points);
          if(old_points < level_start_at && window.experience_points >= level_start_at) {
            window.current_level += 1;
            new_level();
          }
        }

        refresh_texts();
      }

      function fail() {
        // When there is no progress
        var possible_messages = levels[window.current_level].fail_messages;
        var choosen_msg_id = random_from_list(possible_messages);
        var message = fail_messages[choosen_msg_id];
        window.consecutive_successes = 0;
        refresh_texts();
        alert(message);
      }

      function start_game() {
        // Init game starting with user's current experience points
        update_progress();

        new_exercise();
      }

      function load_profile() {
        // Load logged in profile
        window.experience_points = user_profile.experience_points;
        window.current_level = user_profile.level;

        var nickname = user_profile.nickname;
        var photo = user_profile.photo;

        $("p#info-nickname span").text(nickname);
      }

      // OK, let's start.
      if(window.is_logged_in) {
        load_profile();
      }

      start_game();

      // These are for testing:

      // In case of success:
      $("button#some-experience").on("click", update_progress);

      // In case of fail:
      $("button#fail").on("click", fail);
    });
  </script>
</body>
</html>
