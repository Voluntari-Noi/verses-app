<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Versete de memorat - Pentru Cer</title>
  <meta name="description" content="Description here">
</head>

<style>
  body {
    background: #DDDDDD;
  }

  h1 {
    text-align: center;
  }

  div#exercise-container {
    width: 60%;
    background: white;
    margin-left: 20%;
    padding: 20px;
  }

  .debug {
    color: red;
  }

  div#exercise-board {
    margin: 20px 0 20px 0;
    background: #333333;
    padding: 100px;
  }

  div#exercise-controls {
    width: 60%;
    background: #EEEEEE;
    margin-left: 20%;
    padding: 20px;
  }
</style>

<body>
  <h1>Versete de memorat</h1>

  <div id="exercise-container">
    <div id="exercise-info">
      <p class="exercise-id debug">Exercise ID</p>
      <p class="exercise-title">Exercise type here</p>
      <p class="exercise-description">Exercise description here</p>
      <p class="exercise-points debug">Points if you succeed</p>
    </div>

    <div id="exercise-board">
      <p class="debug">TODO implement this for each exercise type</p>
    </div>
  </div>

  <div id="exercise-controls">
    <p id="info-level">Level <span>1</span></p>
    <p id="info-points"><span>0</span> points</p>
    <button id="fail">Fail</button>
    <button id="some-experience">Success</button>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

  <script>
    $("document").ready(function() {
      // Init game
      window.current_level = 1;
      window.experience_points = 0;
      window.number_of_levels = 5;
      window.points_per_level = 20;
      window.current_exercise_type = 'ID001';


      // Definition of exercises types
      window.exercises_types = {
        'ID001': {
          'title': 'Cuvinte lipsă',
          'description': 'Mută cuvintele la locul potrivit.',
          'points': 1,
        },
        'ID002': {
          'title': 'Toate cuvintele',
          'description': 'Aranjează cuvintele în ordinea potrivită, descoperă versetul.',
          'points': 2,
        },
        'ID003': {
          'title': 'Puzzle',
          'description': 'Rezolvă puzzle-ul, învață versetul.',
          'points': 5,
        },
      }

      // Definition of nice messages listed on success
      window.success_messages = {
        'M001': 'Bravo!',
        'M002': 'Uaaaa!',
        'M003': 'Super. Ai rezolvat corect!',
        'M004': 'Se vede mult progres. Frumos!',
        'M005': 'Sunt mândru de tine. Felicitări!',
        'M006': 'Yeeey! Foarte foarte tare!'
      }

      // Definition of messages to be listed on fail
      window.fail_messages = {
        'F001': 'Ops!',
        'F002': 'Of... Nu.',
        'F003': 'Mai încearcă.',
        'F004': 'Ai greșit...',
        'F005': 'Hmm. Nu chiar.',
        'F006': 'Of of of'
      }

      // Definition of levels
      window.levels = {
        1: {
          'exercises_types': ['ID001'],
          'success_messages': ['M001', 'M002'],
          'fail_messages': ['F001']
        },
        2: {
          'exercises_types': ['ID001', 'ID002'],
          'success_messages': ['M002', 'M003'],
          'fail_messages': ['F002', 'F003']
        },
        3: {
          'exercises_types': ['ID001', 'ID002', 'ID003'],
          'success_messages': ['M003', 'M004'],
          'fail_messages': ['F003']
        },
        4: {
          'exercises_types': ['ID003'],
          'success_messages': ['M004', 'M005'],
          'fail_messages': ['F003', 'F004', 'F005']
        },
        5: {
          'exercises_types': ['ID001', 'ID002', 'ID003'],
          'success_messages': ['M005', 'M006'],
          'fail_messages': ['F006']
        },
      }

      function random_from_list(list) {
        // Return a random item from a list (array) of elements
        return list[Math.floor(Math.random() * list.length)];
      }

      function refresh_texts() {
        // Update experience points and current level
        $("p#info-points span").text(experience_points);
        $("p#info-level span").text(current_level);
      }

      function game_over() {
        // You won!
        alert("You won the game. Congrats!");
        $("button#some-experience").hide();
        $("button#fail").hide();
      }

      function new_level() {
        // New level
        alert("New level. Yey!");
      }

      function new_exercise() {
        // Start a new exercise
        if(current_level === 0) {
          return;  // TODO fix me
        }

        console.log("New exercise:");
        var possible_exercises = levels[current_level].exercises_types;
        var choosen_exercise_id = random_from_list(possible_exercises);
        console.log(possible_exercises);
        console.log(choosen_exercise_id);

        var exercise = exercises_types[choosen_exercise_id];

        current_exercise_type = choosen_exercise_id;

        $("div#exercise-info p.exercise-id").text(choosen_exercise_id);
        $("div#exercise-info p.exercise-title").text(exercise.title);
        $("div#exercise-info p.exercise-description").text(exercise.description);
        $("div#exercise-info p.exercise-points").text(exercise.points);

        console.log(current_exercise_type);
      }

      function update_progress() {
        // Update the experience points, check levels
        var old_points = experience_points;

        var points_for_this = exercises_types[current_exercise_type].points;
        console.log("Ai câștigat " + points_for_this + " punct(e)!");

        var possible_messages = levels[current_level].success_messages;
        var choosen_msg_id = random_from_list(possible_messages);
        var message = success_messages[choosen_msg_id];
        alert(message);

        experience_points += points_for_this;
        new_exercise();

        if(experience_points >= number_of_levels * points_per_level) {
          game_over();
        } else {
          var level_start_at = current_level * points_per_level;

          if(old_points < level_start_at && experience_points >= level_start_at) {
            current_level += 1;
            new_level();
          }
        }

        refresh_texts();
      }

      function fail() {
        // When there is no progress
        var possible_messages = levels[current_level].fail_messages;
        var choosen_msg_id = random_from_list(possible_messages);
        var message = fail_messages[choosen_msg_id];
        alert(message);
      }

      function start_game(experience_points) {
        // Init game starting with user's current experience points
        update_progress();

        new_exercise();
      }

      // OK, let's start.
      start_game(experience_points);

      // These are for testing:

      // In case of success:
      $("button#some-experience").on("click", update_progress);

      // In case of fail:
      $("button#fail").on("click", fail);
    });
  </script>
</body>
</html>
